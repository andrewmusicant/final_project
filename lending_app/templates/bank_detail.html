{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/bank_detail.css' %}">
{% endblock %}

{% block body %}
<style type="text/css">
    .dollars:before { content:'$'; }
</style>
<div class="bank-detail">
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-6">
        <div class="bank-large">
          <h3>{{ bank.name }}</h3>
          <h1 class="score">65%</h1>
        </div>
      </div>
      <div class="col-xs-6">
        <div class="bank-info">
          <div class="bank-info-row row-1 vcenter">
            <p>Total Assets: <span class="dollars">{{ bank.total_assets }}</span></p>
          </div>
          <div class="bank-info-row row-2 vcenter">
            <p>Number of Branches: {{ bank.number_domestic_offices }}</p>
          </div>
          <div class="bank-info-row row-3 vcenter">
            <p>Number of Employees: {{ bank.number_of_employees }}</p>
          </div>
          <div class="bank-info-row row-4 vcenter">
            <p>Number of Complaints: 15</p>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <div class="bank-charts">
          <div class="bank-chart-col col-1">
            <div id="pieChart"></div>
          </div>
          <div class="bank-chart-col col-2"; style="padding-left:3px">
              <div>
                <h5> Total Liablity: <span class="dollars">{{ bank.total_liability }}</span></h5>
                <h5> Return On Equity: {{ bank.return_on_equity }}</h5>
                <h5> Total Deposits: <span class="dollars">{{ bank.total_deposits }}</span></h5>
                <h5> Common Stock: {{ bank.common_stock }}</h5>
                <h5> Return On Assets: {{ bank.return_on_assets }}</h5>
                <h5> Retained Earnings to Average Equity: {{ bank.retained_earnings_to_average_equity }}</h5>
              </div>
          </div>
          <div class="bank-chart-col col-3">
              <h5 id="bartitle">Total Number of Loans</h5>
              <div id="barchart"; style="padding-left:50px"></div>
          </div>
          <div class="bank-chart-col col-4"; style="padding-left:3px">
            <h5> Total Amount of Real Estate Loans: {{ bank.total_amount_individual }}</h5>
            <h5> Home Equity Loans: {{ bank.home_equity_loans }}</h5>

         </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- <div id="table_div"></div>
<div id="pieChart"></div> -->
{% endblock %}

{% block scripts %}
<!-- <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load("current", {packages:["corechart", 'table']});
  google.charts.setOnLoadCallback(drawChart);
  function drawChart() {

      var data2 = new google.visualization.DataTable();
      data2.addColumn('number', 'Total Assets');
      data2.addColumn('number', 'Total Liability');
      data2.addColumn('number', 'ROE');
      data2.addColumn('number', 'Small Loans');
      data2.addColumn('number', 'Micro Loans');
      data2.addColumn('number', 'Farm Loans');
      data2.addColumn('number', 'Total Loans');
      data2.addColumn('number', 'Ind. Amount');
      data2.addColumn('number', 'Small');
      data2.addColumn('number', 'Micro');
      data2.addColumn('number', 'Farm');
      data2.addColumn('number', 'Jar Score');
      data2.addRows([

            [{{ bank.total_assets }},
            {{ bank.total_liability }},
            {{ bank.return_on_equity }},
            {{ bank.total_num_loans_small }},
            {{ bank.total_num_loans_micro }},
            {{ bank.total_num_loans_farm }},
            {{ bank.total_loans }},
            {{ bank.total_amount_individual }},
            {{ bank.total_amount_small  }},
            {{ bank.total_amount_micro  }},
            {{ bank.total_amount_farm }},
            {{ bank.return_on_equity }}],

  ]);
    var table = new google.visualization.Table(document.getElementById('table_div'));

    table.draw(data2, {
      showRowNumber: false,
      width: '100%',
      height: '100%'
    });
  }
</script> -->
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.4/d3.min.js"></script>
<script src="{% static 'js/d3pie.min.js' %}"></script>
<script>
var pie = new d3pie("pieChart", {
	"header": {
		"title": {
			"text": "Percentages Of Loans for Bank",
			"fontSize": 12,
			"font": "open sans"
		},
		"subtitle": {
			"color": "#999999",
			"fontSize": 12,
			"font": "Josefin sans"
		},
		"titleSubtitlePadding": 10
	},
	"footer": {
		"color": "#999999",
		"fontSize": 10,
		"font": "open sans",
		"location": "left"
	},
	"size": {
		"canvasWidth": 280,
    "canvasHeight": 280,
		"pieOuterRadius": "90%"
	},
	"data": {
		"sortOrder": "value-desc",
		"content": [
			{
				"label": "Small Business",
				"value": ({{bank.small_loan_percentage}}*100),
				"color": "#B2EBF2"
			},
			{
				"label": "Individual",
				"value": ({{bank.individual_loan_percentage}}*100),
				"color": "#0097A7"
			},
			{
				"label": "Farm",
				"value": ({{bank.farm_loan_percentage}}*100),
				"color": "#00BCD4"
			},
			{
				"label": "Micro",
				"value": ({{bank.micro_loan_percentage}}*100),
				"color": "#4DD0E1"
			}
		]
	},
	"labels": {
		"outer": {
			"pieDistance": 32
		},
		"inner": {
			"hideWhenLessThanPercentage": 3
		},
		"mainLabel": {
			"fontSize": 11
		},
		"percentage": {
			"color": "#ffffff",
			"decimalPlaces": 0
		},
		"value": {
			"color": "#adadad",
			"fontSize": 11
		},
		"lines": {
			"enabled": true
		},
		"truncation": {
			"enabled": true
		}
	},
  "effects": {
		"pullOutSegmentOnClick": {
			"effect": "linear",
			"speed": 100,
			"size": 8
		}
	},
	"misc": {
		"gradient": {
			"enabled": true,
			"percentage": 100
		}
	}
});
</script>

<script>var w = 150;
var h = 180;

var dataset = [
	{ key: 0, value: 5 },
	{ key: 1, value: 10 },
	{ key: 2, value: 13 },
	{ key: 3, value: 19 },
	{ key: 4, value: 21 },
 ];

var xScale = d3.scale.ordinal()
				.domain(d3.range(dataset.length))
				.rangeRoundBands([0, w], 0.05);

var yScale = d3.scale.linear()
				.domain([0, d3.max(dataset, function(d) {return d.value;})])
				.range([0, h]);

var key = function(d) {
	return d.key;
};

//Create SVG element
var svg = d3.select("#barchart")
			.append("svg")
			.attr("width", w)
			.attr("height", h);

//Create bars
svg.selectAll("rect")
   .data(dataset, key)
   .enter()
   .append("rect")
   .attr("x", function(d, i) {
		return xScale(i);
   })
   .attr("y", function(d) {
		return h - yScale(d.value);
   })
   .attr("width", xScale.rangeBand())
   .attr("height", function(d) {
		return yScale(d.value);
   })
   .attr("fill", function(d) {
		return "#00838F";
   })

	//Tooltip
	.on("mouseover", function(d) {
		//Get this bar's x/y values, then augment for the tooltip
		var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
		var yPosition = parseFloat(d3.select(this).attr("y")) + 14;

		//Update Tooltip Position & value
		d3.select("#tooltip")
			.style("left", xPosition + "px")
			.style("top", yPosition + "px")
			.select("#value")
			.text(d.value);
		d3.select("#tooltip").classed("hidden", false)
	})
	.on("mouseout", function() {
		//Remove the tooltip
		d3.select("#tooltip").classed("hidden", true);
	})	;

//Create labels
svg.selectAll("text")
   .data(dataset, key)
   .enter()
   .append("text")
   .text(function(d) {
		return d.value;
   })
   .attr("text-anchor", "middle")
   .attr("x", function(d, i) {
		return xScale(i) + xScale.rangeBand() / 2;
   })
   .attr("y", function(d) {
		return h - yScale(d.value) + 14;
   })
   .attr("font-family", "sans-serif")
   .attr("font-size", "11px")
   .attr("fill", "white");

var sortOrder = false;
var sortBars = function () {
    sortOrder = !sortOrder;

    sortItems = function (a, b) {
        if (sortOrder) {
            return a.value - b.value;
        }
        return b.value - a.value;
    };

    svg.selectAll("rect")
        .sort(sortItems)
        .transition()
        .delay(function (d, i) {
        return i * 50;
    })
        .duration(1000)
        .attr("x", function (d, i) {
        return xScale(i);
    });

    svg.selectAll('text')
        .sort(sortItems)
        .transition()
        .delay(function (d, i) {
        return i * 50;
    })
        .duration(1000)
        .text(function (d) {
        return d.value;
    })
        .attr("text-anchor", "middle")
        .attr("x", function (d, i) {
        return xScale(i) + xScale.rangeBand() / 2;
    })
        .attr("y", function (d) {
        return h - yScale(d.value) + 14;
    });
};
// Add the onclick callback to the button
d3.select("#sort").on("click", sortBars);
d3.select("#reset").on("click", reset);
function randomSort() {


	svg.selectAll("rect")
        .sort(sortItems)
        .transition()
        .delay(function (d, i) {
        return i * 50;
    })
        .duration(1000)
        .attr("x", function (d, i) {
        return xScale(i);
    });

    svg.selectAll('text')
        .sort(sortItems)
        .transition()
        .delay(function (d, i) {
        return i * 50;
    })
        .duration(1000)
        .text(function (d) {
        return d.value;
    })
        .attr("text-anchor", "middle")
        .attr("x", function (d, i) {
        return xScale(i) + xScale.rangeBand() / 2;
    })
        .attr("y", function (d) {
        return h - yScale(d.value) + 14;
    });
}
function reset() {
	svg.selectAll("rect")
		.sort(function(a, b){
			return a.key - b.key;
		})
		.transition()
        .delay(function (d, i) {
        return i * 50;
		})
        .duration(1000)
        .attr("x", function (d, i) {
        return xScale(i);
		});

	svg.selectAll('text')
        .sort(function(a, b){
			return a.key - b.key;
		})
        .transition()
        .delay(function (d, i) {
        return i * 50;
    })
        .duration(1000)
        .text(function (d) {
        return d.value;
    })
        .attr("text-anchor", "middle")
        .attr("x", function (d, i) {
        return xScale(i) + xScale.rangeBand() / 2;
    })
        .attr("y", function (d) {
        return h - yScale(d.value) + 14;
    });
};
</script>
{% endblock %}
